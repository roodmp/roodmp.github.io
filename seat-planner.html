<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wedding Seat Planner - Mark Rood</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <link rel="icon" type="image/x-icon" href="favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Instrument+Serif:ital,wght@0,400;1,400&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="main.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // AI-focused futuristic palette
                        primary: {
                            50: '#EBF4FF',
                            100: '#D1E7FF',
                            200: '#A6D0FF',
                            300: '#7AB8FF',
                            400: '#4F9FFF',
                            500: '#2563EB',
                            600: '#1E40AF',
                            700: '#1E3A8A',
                            800: '#1E2A69',
                            900: '#1A1F37'
                        },
                        ai: {
                            cyan: '#06B6D4',
                            purple: '#8B5CF6',
                            blue: '#3B82F6',
                            indigo: '#6366F1',
                            violet: '#7C3AED'
                        },
                        surface: {
                            primary: '#0F0F0F',
                            secondary: '#1A1A1A',
                            tertiary: '#262626',
                            border: '#404040'
                        },
                        text: {
                            primary: '#FFFFFF',
                            secondary: '#E2E8F0',
                            tertiary: '#CBD5E1'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes single-pulse-glow {
            0%, 100% {
                border-color: rgb(156 163 175);
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
            50% {
                border-color: rgb(59 130 246);
                box-shadow: 0 0 8px 2px rgba(59, 130, 246, 0.4);
            }
        }

        @media (prefers-color-scheme: dark) {
            @keyframes single-pulse-glow {
                0%, 100% {
                    border-color: rgb(75 85 99);
                    box-shadow: 0 0 0 0 rgba(147, 197, 253, 0);
                }
                50% {
                    border-color: rgb(147 197 253);
                    box-shadow: 0 0 8px 2px rgba(147, 197, 253, 0.4);
                }
            }
        }

        .animate-single-pulse-glow {
            animation: single-pulse-glow 2.5s ease-in-out;
        }

        .floating-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, rgba(6, 182, 212, 0.8), transparent);
            border-radius: 50%;
            animation: particle-float 12s linear infinite;
        }
        
        .floating-particle:nth-child(odd) {
            background: radial-gradient(circle, rgba(139, 92, 246, 0.8), transparent);
            animation-duration: 15s;
        }
        
        @keyframes particle-float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-30px) rotate(120deg); }
            66% { transform: translateY(15px) rotate(240deg); }
        }

        .theme-logo {
            transition: all 0.3s ease;
            filter: invert(1) brightness(1.2) drop-shadow(0 0 4px rgba(255, 255, 255, 0.3));
        }

        .theme-logo:hover {
            transform: scale(1.05);
            filter: invert(1) brightness(1.3) drop-shadow(0 0 6px rgba(255, 255, 255, 0.4));
        }

        .nav-link {
            color: #E2E8F0;
            transition: all 0.2s ease;
            padding: 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
        }

        .nav-link:hover {
            color: #FFFFFF;
            transform: scale(1.05);
        }
        
        .table-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            position: relative;
            transition: all 0.3s ease;
            margin: 2rem;
            padding: 1rem;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .seat {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            position: absolute;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        .seat:hover {
            transform: scale(1.08);
            opacity: 0.8;
        }
        
        .seat-0 { top: -14px; left: 46px; } /* 12 o'clock */
        .seat-1 { top: 14px; right: -14px; } /* 2 o'clock */
        .seat-2 { bottom: 14px; right: -14px; } /* 4 o'clock */
        .seat-3 { bottom: -14px; left: 46px; } /* 6 o'clock */
        .seat-4 { bottom: 14px; left: -14px; } /* 8 o'clock */
        .seat-5 { top: 14px; left: -14px; } /* 10 o'clock */
        
        .guest-item {
            cursor: grab;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 0.75rem;
        }
        
        .guest-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }
        
        .guest-item:active {
            cursor: grabbing;
            transform: scale(0.98);
        }
        
        .guest-item.dragging {
            opacity: 0.6;
            transform: rotate(5deg) scale(1.05);
        }
        
        .table-circle.drop-target {
            transform: scale(1.02);
            box-shadow: 0 0 0 2px #2563eb;
            border-color: #2563eb;
        }
        
        
        /* Notion-style button system */
        .btn {
            padding: 0.5rem 0.875rem;
            border-radius: 0.375rem;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.15s ease;
            border: 1px solid transparent;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
        }
        
        .btn-primary {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
        }
        
        .btn-primary:hover {
            background: #1d4ed8;
            border-color: #1d4ed8;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .btn-ghost {
            background: transparent;
            color: #94a3b8;
            border-color: transparent;
        }
        
        .btn-ghost:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
        }
        
        .btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.8125rem;
        }
        
        .btn-icon {
            padding: 0.5rem;
            min-width: 2rem;
            min-height: 2rem;
        }
        
        /* Dropdown menu */
        .dropdown {
            position: relative;
            display: inline-block;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            z-index: 50;
            min-width: 12rem;
            padding: 0.25rem;
            margin-top: 0.25rem;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(64, 64, 64, 0.5);
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }
        
        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: none;
            background: transparent;
            color: #e2e8f0;
            font-size: 0.875rem;
            text-align: left;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
        }
        
        .dropdown-divider {
            height: 1px;
            margin: 0.25rem 0;
            background: rgba(64, 64, 64, 0.5);
        }
        
        /* Multi-select styles */
        .multi-select {
            position: relative;
        }
        
        .multi-select-button {
            width: 100%;
            min-height: 2.5rem;
            padding: 0.5rem 0.75rem;
            background: #262626;
            border: 1px solid #404040;
            border-radius: 0.5rem;
            color: #e2e8f0;
            font-size: 0.875rem;
            text-align: left;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            transition: all 0.15s ease;
        }
        
        .multi-select-button:hover {
            border-color: #525252;
        }
        
        .multi-select-button:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .multi-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            z-index: 50;
            max-height: 12rem;
            margin-top: 0.25rem;
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(64, 64, 64, 0.5);
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            overflow-y: auto;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.2s ease;
        }
        
        .multi-select-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .multi-select-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0.75rem;
            color: #e2e8f0;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .multi-select-option:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .multi-select-option input[type="checkbox"] {
            width: 1rem;
            height: 1rem;
            accent-color: #2563eb;
        }
        
        .selected-guests {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }
        
        .selected-guest-tag {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.125rem 0.5rem;
            background: rgba(37, 99, 235, 0.2);
            border: 1px solid rgba(37, 99, 235, 0.3);
            border-radius: 1rem;
            color: #93c5fd;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Card-like panels */
        .card-panel {
            background: rgba(26, 26, 26, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(64, 64, 64, 0.5);
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .card-panel:hover {
            border-color: rgba(64, 64, 64, 0.6);
        }
        
        /* Constrain scrollable lists within viewport */
        #guestList {
            min-height: 0 !important;
            max-height: 300px !important;
            overflow-y: auto !important;
            flex: none !important;
        }
        
        #constraintsList {
            min-height: 0 !important;
            max-height: 250px !important;
            overflow-y: auto !important;
            flex: none !important;
        }
        
        /* Table container spacing overrides */
        #tablesContainer {
            gap: 1rem !important;
            padding: 2rem !important;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 1024px) {
            .table-circle {
                margin: 1.5rem;
            }
            #tablesContainer {
                padding: 1.5rem !important;
            }
            
            #guestList {
                max-height: 250px !important;
            }
            
            #constraintsList {
                max-height: 200px !important;
            }
        }
        
        @media (max-width: 768px) {
            .table-circle {
                width: 100px;
                height: 100px;
                margin: 1rem;
                padding: 0.5rem;
            }
            
            .seat {
                width: 24px;
                height: 24px;
                font-size: 10px;
            }
            
            .seat-0 { top: -12px; left: 38px; }
            .seat-1 { top: 12px; right: -12px; }
            .seat-2 { bottom: 12px; right: -12px; }
            .seat-3 { bottom: -12px; left: 38px; }
            .seat-4 { bottom: 12px; left: -12px; }
            .seat-5 { top: 12px; left: -12px; }
            
            .table-circle {
                margin: 1rem;
            }
            #tablesContainer {
                padding: 1rem !important;
            }
            
            #guestList {
                max-height: 200px !important;
            }
            
            #constraintsList {
                max-height: 150px !important;
            }
            
            .game-button {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
                min-width: 44px;
                min-height: 44px;
            }
        }
        
        @media (max-width: 480px) {
            .table-circle {
                width: 80px;
                height: 80px;
                margin: 0.75rem;
                padding: 0.25rem;
            }
            
            .seat {
                width: 20px;
                height: 20px;
                font-size: 9px;
            }
            
            .seat-0 { top: -10px; left: 30px; }
            .seat-1 { top: 10px; right: -10px; }
            .seat-2 { bottom: 10px; right: -10px; }
            .seat-3 { bottom: -10px; left: 30px; }
            .seat-4 { bottom: 10px; left: -10px; }
            .seat-5 { top: 10px; left: -10px; }
            
            .table-circle {
                margin: 0.75rem;
            }
            #tablesContainer {
                padding: 1rem !important;
            }
            
            #guestList {
                max-height: 180px !important;
            }
            
            #constraintsList {
                max-height: 120px !important;
            }
        }
    </style>
</head>

<body class="bg-surface-primary min-h-screen font-['Inter',system-ui,sans-serif] antialiased overflow-x-hidden text-text-primary">
    <!-- Floating particles background -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="floating-particle" style="left: 15%; top: 25%; animation-delay: 0s;"></div>
        <div class="floating-particle" style="left: 85%; top: 15%; animation-delay: -4s;"></div>
        <div class="floating-particle" style="left: 65%; top: 75%; animation-delay: -7s;"></div>
        <div class="floating-particle" style="left: 25%; top: 85%; animation-delay: -11s;"></div>
        <div class="floating-particle" style="left: 95%; top: 55%; animation-delay: -14s;"></div>
        <div class="floating-particle" style="left: 35%; top: 35%; animation-delay: -18s;"></div>
        <div class="floating-particle" style="left: 75%; top: 45%; animation-delay: -22s;"></div>
        <div class="floating-particle" style="left: 5%; top: 65%; animation-delay: -25s;"></div>
    </div>

    <!-- Navigation hidden for seat planner -->
    <main id="main-content" class="min-h-screen" role="main">
        <div class="container mx-auto px-4">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold tracking-tight text-text-primary my-3">Seat Planner (Updated v2.0)</h1>
                <p class="text-lg text-text-secondary">Organize your seating arrangements with ease</p>
            </div>

            <!-- Main Layout -->
            <div class="flex flex-wrap gap-6 h-[calc(100vh-8rem)] min-h-0">
                <!-- Left Sidebar: Guest Management -->
                <div class="w-full lg:flex-1 lg:basis-1/4 card-panel p-4 flex flex-col min-h-0">
                    <h2 class="text-xl font-semibold mb-4 text-text-primary">Guest Management</h2>
                    
                    <!-- Add Guest -->
                    <div class="mb-4">
                        <div class="mb-2">
                            <input type="text" id="guestNameInput" placeholder="Enter guest name and press Enter" 
                                class="w-full px-3 py-2 bg-surface-tertiary border border-surface-border rounded-lg text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-primary-500">
                        </div>
                    </div>

                    <!-- Guest List -->
                    <div class="mb-4 flex-1 flex flex-col min-h-0 overflow-hidden">
                        <h3 class="font-medium mb-2 text-text-primary">Guests (<span id="guestCount">0</span>)</h3>
                        <div id="guestList" class="space-y-1">
                            <!-- Guest items will be added here -->
                        </div>
                    </div>

                    <!-- Bulk Import -->
                    <div class="pb-2">
                        <div class="flex gap-2 mb-2">
                            <button id="bulkImportToggle" class="flex-1 btn btn-ghost btn-sm">
                                Bulk Import
                            </button>
                            <div class="dropdown">
                                <button id="guestMenuBtn" class="btn btn-ghost btn-icon btn-sm">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <circle cx="12" cy="12" r="1"></circle>
                                        <circle cx="12" cy="5" r="1"></circle>
                                        <circle cx="12" cy="19" r="1"></circle>
                                    </svg>
                                </button>
                                <div id="guestMenu" class="dropdown-menu">
                                    <button id="loadSampleDataBtn" class="dropdown-item">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>
                                        </svg>
                                        Load Sample Data
                                    </button>
                                    <div class="dropdown-divider"></div>
                                    <button id="clearAllGuestsBtn" class="dropdown-item text-red-400">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                        Clear All Guests
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div id="bulkImportSection" class="hidden mt-2">
                            <textarea id="bulkImportText" placeholder="Paste names, one per line" 
                                class="w-full px-3 py-2 bg-surface-tertiary border border-surface-border rounded-lg text-text-primary placeholder-text-tertiary focus:outline-none focus:ring-2 focus:ring-primary-500 h-24 text-sm"></textarea>
                            <button id="processBulkImport" class="w-full mt-2 btn btn-primary btn-sm">
                                Import
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Center: Table Visualization -->
                <div class="w-full lg:flex-1 lg:basis-1/2 card-panel p-8 flex flex-col min-h-0">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-text-primary">Seating Chart</h2>
                        <div class="flex gap-2">
                            <button id="autoArrangeBtn" class="btn btn-primary">
                                Auto Arrange
                            </button>
                            <button id="clearAllBtn" class="btn btn-ghost">
                                Clear All
                            </button>
                        </div>
                    </div>
                    
                    <!-- Tables Grid -->
                    <div class="flex-1 overflow-y-auto overflow-x-hidden">
                        <div id="tablesContainer" class="flex flex-wrap justify-center items-start p-4">
                            <!-- Tables will be generated here -->
                        </div>
                    </div>
                    
                    <!-- Status -->
                    <div class="mt-4 text-center flex-shrink-0">
                        <div id="statusMessage" class="text-text-secondary"></div>
                    </div>
                </div>

                <!-- Right Sidebar: Seating Rules -->
                <div class="w-full lg:flex-1 lg:basis-1/4 card-panel p-6 flex flex-col min-h-0">
                    <h2 class="text-xl font-semibold mb-2 text-text-primary">Seating Rules</h2>
                    
                    <!-- Add Seating Rule -->
                    <div class="mb-4">
                        <div class="mb-3">
                            <div class="selected-guests" id="selectedGuests"></div>
                            <div class="multi-select">
                                <button type="button" id="guestMultiSelect" class="multi-select-button">
                                    <span id="multiSelectText">Select guests...</span>
                                    <svg class="w-4 h-4 transition-transform" id="multiSelectChevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                    </svg>
                                </button>
                                <div id="guestMultiSelectDropdown" class="multi-select-dropdown">
                                    <!-- Options will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="multi-select mb-3">
                            <select id="constraintType" class="multi-select-button" style="appearance: none; cursor: pointer;">
                                <option value="must_sit_together">Must sit together</option>
                                <option value="must_not_sit_together">Must not sit together</option>
                            </select>
                        </div>
                        <button id="addConstraintBtn" class="w-full btn btn-primary">
                            Create Rule(s)
                        </button>
                    </div>

                    <!-- Active Seating Rules -->
                    <div class="flex-1 flex flex-col min-h-0 overflow-hidden">
                        <h3 class="font-medium mb-2 text-text-primary">Active Rules (<span id="constraintCount">0</span>)</h3>
                        <div id="constraintsList" class="space-y-2">
                            <!-- Seating rules will be added here -->
                        </div>
                    </div>

                    <!-- Validation Status -->
                    <div class="mt-4 p-4 card-panel flex-shrink-0" id="validationStatus">
                        <div class="text-sm text-text-secondary">All rules satisfied ✓</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Updated: Multi-guest selection and styling fixes - v2.0
        // Haptic feedback utility
        function triggerHapticFeedback(type = 'light') {
            if ('vibrate' in navigator) {
                switch (type) {
                    case 'light':
                        navigator.vibrate(50);
                        break;
                    case 'medium':
                        navigator.vibrate(100);
                        break;
                    case 'success':
                        navigator.vibrate([100, 50, 100]);
                        break;
                    case 'error':
                        navigator.vibrate([200, 100, 200]);
                        break;
                }
            }
        }

        // Wedding Table Planner Application
        class WeddingSeatPlanner {
            constructor() {
                this.guests = [];
                this.constraints = [];
                this.tables = [];
                this.draggedGuest = null;
                this.selectedGuestIds = new Set();
                
                this.initializeTables();
                this.bindEvents();
                this.loadFromStorage();
                this.render();
            }

            initializeTables() {
                for (let i = 1; i <= 10; i++) {
                    this.tables.push({
                        id: `table_${i}`,
                        number: i,
                        capacity: 6,
                        guests: new Array(6).fill(null)
                    });
                }
            }

            bindEvents() {
                // Guest management
                const guestInput = document.getElementById('guestNameInput');
                if (guestInput) {
                    guestInput.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.addGuest();
                        }
                    });
                }
                
                document.getElementById('loadSampleDataBtn').addEventListener('click', () => this.loadSampleData());
                
                // Bulk import
                document.getElementById('bulkImportToggle').addEventListener('click', () => this.toggleBulkImport());
                document.getElementById('processBulkImport').addEventListener('click', () => this.processBulkImport());
                
                // Guest menu dropdown
                const menuBtn = document.getElementById('guestMenuBtn');
                if (menuBtn) {
                    menuBtn.addEventListener('click', (e) => {
                        this.toggleGuestMenu(e);
                    });
                }
                document.getElementById('clearAllGuestsBtn').addEventListener('click', () => this.clearAllGuests());
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => this.handleOutsideClick(e));
                
                // Seating Rules
                document.getElementById('addConstraintBtn').addEventListener('click', () => this.addConstraint());
                document.getElementById('guestMultiSelect').addEventListener('click', (e) => this.toggleMultiSelect(e));
                
                // Close multi-select when clicking outside
                document.addEventListener('click', (e) => this.handleMultiSelectOutsideClick(e));
                
                // Table actions
                document.getElementById('autoArrangeBtn').addEventListener('click', () => this.autoArrange());
                document.getElementById('clearAllBtn').addEventListener('click', () => this.clearAllTables());
            }

            addGuest() {
                const nameInput = document.getElementById('guestNameInput');
                const name = nameInput.value.trim();
                
                if (!name) return;
                
                if (this.guests.find(g => g.name.toLowerCase() === name.toLowerCase())) {
                    alert('Guest already exists!');
                    return;
                }
                
                const guest = {
                    id: `guest_${Date.now()}`,
                    name: name,
                    tableId: null,
                    seatPosition: null
                };
                
                this.guests.push(guest);
                nameInput.value = '';
                this.saveToStorage();
                this.render();
            }

            removeGuest(guestId) {
                // Remove guest from tables
                this.tables.forEach(table => {
                    table.guests = table.guests.map(g => g === guestId ? null : g);
                });
                
                // Remove constraints involving this guest
                this.constraints = this.constraints.filter(c => 
                    c.guest1Id !== guestId && c.guest2Id !== guestId
                );
                
                // Remove from guests list
                this.guests = this.guests.filter(g => g.id !== guestId);
                
                this.saveToStorage();
                this.render();
            }

            toggleBulkImport() {
                const section = document.getElementById('bulkImportSection');
                section.classList.toggle('hidden');
            }

            processBulkImport() {
                const text = document.getElementById('bulkImportText').value;
                const names = text.split('\n').map(n => n.trim()).filter(n => n);
                
                names.forEach(name => {
                    if (!this.guests.find(g => g.name.toLowerCase() === name.toLowerCase())) {
                        this.guests.push({
                            id: `guest_${Date.now()}_${Math.random()}`,
                            name: name,
                            tableId: null,
                            seatPosition: null
                        });
                    }
                });
                
                document.getElementById('bulkImportText').value = '';
                document.getElementById('bulkImportSection').classList.add('hidden');
                this.saveToStorage();
                this.render();
            }

            addConstraint() {
                const selectedGuestIds = Array.from(this.selectedGuestIds);
                const type = document.getElementById('constraintType').value;
                
                if (selectedGuestIds.length < 2) {
                    this.showNotification('Please select at least 2 guests', 'error');
                    triggerHapticFeedback('error');
                    return;
                }
                
                // For groups larger than 2, create pairwise constraints
                const newConstraints = [];
                
                for (let i = 0; i < selectedGuestIds.length; i++) {
                    for (let j = i + 1; j < selectedGuestIds.length; j++) {
                        const guest1Id = selectedGuestIds[i];
                        const guest2Id = selectedGuestIds[j];
                        
                        // Check if constraint already exists
                        const exists = this.constraints.find(c => 
                            (c.guest1Id === guest1Id && c.guest2Id === guest2Id) ||
                            (c.guest1Id === guest2Id && c.guest2Id === guest1Id)
                        );
                        
                        if (!exists) {
                            const constraint = {
                                id: `constraint_${Date.now()}_${i}_${j}`,
                                guest1Id: guest1Id,
                                guest2Id: guest2Id,
                                type: type,
                                satisfied: true
                            };
                            newConstraints.push(constraint);
                        }
                    }
                }
                
                if (newConstraints.length === 0) {
                    this.showNotification('All seating rules between selected guests already exist', 'error');
                    triggerHapticFeedback('error');
                    return;
                }
                
                this.constraints.push(...newConstraints);
                
                const groupSize = selectedGuestIds.length;
                const rulesCreated = newConstraints.length;
                this.showNotification(`Created ${rulesCreated} seating rule(s) for ${groupSize} guests`, 'success');
                
                // Clear selection
                this.selectedGuestIds.clear();
                this.closeMultiSelect();
                
                this.saveToStorage();
                this.render();
                triggerHapticFeedback('medium');
            }

            removeConstraint(constraintId) {
                this.constraints = this.constraints.filter(c => c.id !== constraintId);
                this.saveToStorage();
                this.render();
            }

            clearAllTables() {
                if (confirm('Are you sure you want to clear all table assignments?')) {
                    this.tables.forEach(table => {
                        table.guests = new Array(6).fill(null);
                    });
                    this.saveToStorage();
                    this.render();
                }
            }
            
            clearAllGuests() {
                if (confirm('Are you sure you want to remove all guests? This will also clear all seating rules and table assignments.')) {
                    this.guests = [];
                    this.constraints = [];
                    this.tables.forEach(table => {
                        table.guests = new Array(6).fill(null);
                    });
                    this.saveToStorage();
                    this.render();
                    this.showNotification('All guests cleared', 'info');
                    this.closeGuestMenu();
                    triggerHapticFeedback('light');
                }
            }
            
            toggleGuestMenu(e) {
                e.stopPropagation();
                const menu = document.getElementById('guestMenu');
                menu.classList.toggle('show');
            }
            
            closeGuestMenu() {
                const menu = document.getElementById('guestMenu');
                menu.classList.remove('show');
            }
            
            handleOutsideClick(e) {
                const menu = document.getElementById('guestMenu');
                const menuBtn = document.getElementById('guestMenuBtn');
                
                if (!menu.contains(e.target) && !menuBtn.contains(e.target)) {
                    this.closeGuestMenu();
                }
            }
            
            toggleMultiSelect(e) {
                e.stopPropagation();
                const dropdown = document.getElementById('guestMultiSelectDropdown');
                const chevron = document.getElementById('multiSelectChevron');
                
                dropdown.classList.toggle('show');
                chevron.style.transform = dropdown.classList.contains('show') ? 'rotate(180deg)' : 'rotate(0deg)';
            }
            
            closeMultiSelect() {
                const dropdown = document.getElementById('guestMultiSelectDropdown');
                const chevron = document.getElementById('multiSelectChevron');
                
                dropdown.classList.remove('show');
                chevron.style.transform = 'rotate(0deg)';
            }
            
            handleMultiSelectOutsideClick(e) {
                const multiSelect = document.querySelector('.multi-select');
                const guestMenu = document.getElementById('guestMenu');
                
                if (!multiSelect.contains(e.target) && !guestMenu.contains(e.target)) {
                    this.closeMultiSelect();
                }
            }
            
            toggleGuestSelection(guestId) {
                if (this.selectedGuestIds.has(guestId)) {
                    this.selectedGuestIds.delete(guestId);
                } else {
                    this.selectedGuestIds.add(guestId);
                }
                this.updateMultiSelectUI();
            }
            
            updateMultiSelectUI() {
                // Update selected guests display
                const selectedContainer = document.getElementById('selectedGuests');
                const textSpan = document.getElementById('multiSelectText');
                
                selectedContainer.innerHTML = '';
                
                if (this.selectedGuestIds.size === 0) {
                    textSpan.textContent = 'Select guests...';
                } else {
                    const selectedNames = Array.from(this.selectedGuestIds).map(id => {
                        const guest = this.guests.find(g => g.id === id);
                        return guest ? guest.name : '';
                    }).filter(name => name);
                    
                    textSpan.textContent = `${selectedNames.length} guest${selectedNames.length !== 1 ? 's' : ''} selected`;
                    
                    // Show selected guest tags
                    selectedNames.forEach((name, index) => {
                        const guestId = Array.from(this.selectedGuestIds)[index];
                        const tag = document.createElement('span');
                        tag.className = 'selected-guest-tag';
                        tag.innerHTML = `
                            ${name}
                            <button type="button" onclick="seatPlanner.toggleGuestSelection('${guestId}')" class="ml-1 hover:text-red-300">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        `;
                        selectedContainer.appendChild(tag);
                    });
                }
                
                // Update checkboxes in dropdown
                const checkboxes = document.querySelectorAll('#guestMultiSelectDropdown input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.selectedGuestIds.has(checkbox.value);
                });
            }

            assignGuestToSeat(guestId, tableId, seatIndex) {
                // Remove guest from current position
                this.tables.forEach(table => {
                    table.guests = table.guests.map(g => g === guestId ? null : g);
                });
                
                // Assign to new position
                const table = this.tables.find(t => t.id === tableId);
                if (table && table.guests[seatIndex] === null) {
                    table.guests[seatIndex] = guestId;
                    this.saveToStorage();
                    this.render();
                    return true;
                }
                return false;
            }

            validateConstraints() {
                let allSatisfied = true;
                
                this.constraints.forEach(constraint => {
                    const guest1Table = this.getGuestTable(constraint.guest1Id);
                    const guest2Table = this.getGuestTable(constraint.guest2Id);
                    
                    if (constraint.type === 'must_sit_together') {
                        constraint.satisfied = guest1Table && guest2Table && guest1Table.id === guest2Table.id;
                    } else if (constraint.type === 'must_not_sit_together') {
                        constraint.satisfied = !guest1Table || !guest2Table || guest1Table.id !== guest2Table.id;
                    }
                    
                    if (!constraint.satisfied) {
                        allSatisfied = false;
                    }
                });
                
                return allSatisfied;
            }

            getGuestTable(guestId) {
                return this.tables.find(table => table.guests.includes(guestId));
            }

            autoArrange() {
                // Simple auto-arrangement algorithm
                // Clear all assignments first
                this.tables.forEach(table => {
                    table.guests = new Array(6).fill(null);
                });
                
                const unassignedGuests = [...this.guests.map(g => g.id)];
                
                // First pass: try to satisfy "must sit together" constraints
                const processedPairs = new Set();
                
                this.constraints.forEach(constraint => {
                    if (constraint.type === 'must_sit_together') {
                        const pairKey = [constraint.guest1Id, constraint.guest2Id].sort().join('-');
                        if (processedPairs.has(pairKey)) return;
                        processedPairs.add(pairKey);
                        
                        if (unassignedGuests.includes(constraint.guest1Id) && 
                            unassignedGuests.includes(constraint.guest2Id)) {
                            
                            // Find a table with at least 2 seats
                            const availableTable = this.tables.find(table => 
                                table.guests.filter(g => g === null).length >= 2
                            );
                            
                            if (availableTable) {
                                const emptySeat1 = availableTable.guests.findIndex(g => g === null);
                                const emptySeat2 = availableTable.guests.findIndex((g, i) => g === null && i !== emptySeat1);
                                
                                availableTable.guests[emptySeat1] = constraint.guest1Id;
                                availableTable.guests[emptySeat2] = constraint.guest2Id;
                                
                                unassignedGuests.splice(unassignedGuests.indexOf(constraint.guest1Id), 1);
                                unassignedGuests.splice(unassignedGuests.indexOf(constraint.guest2Id), 1);
                            }
                        }
                    }
                });
                
                // Second pass: assign remaining guests while avoiding "must not sit together" constraints
                unassignedGuests.forEach(guestId => {
                    const mustNotSitWith = this.constraints
                        .filter(c => c.type === 'must_not_sit_together' && 
                                (c.guest1Id === guestId || c.guest2Id === guestId))
                        .map(c => c.guest1Id === guestId ? c.guest2Id : c.guest1Id);
                    
                    // Find a table where none of the "must not sit together" guests are seated
                    const availableTable = this.tables.find(table => {
                        const hasConflict = table.guests.some(g => g && mustNotSitWith.includes(g));
                        const hasSpace = table.guests.includes(null);
                        return !hasConflict && hasSpace;
                    });
                    
                    if (availableTable) {
                        const emptySeat = availableTable.guests.findIndex(g => g === null);
                        availableTable.guests[emptySeat] = guestId;
                    }
                });
                
                this.saveToStorage();
                this.render();
            }

            loadSampleData() {
                if (this.guests.length > 0 && !confirm('This will replace existing data. Continue?')) {
                    return;
                }
                
                // Sample wedding guests
                const sampleGuests = [
                    'Sarah Johnson', 'Michael Chen', 'Emily Davis', 'James Wilson',
                    'Jessica Martinez', 'David Thompson', 'Amanda Rodriguez', 'Christopher Lee',
                    'Ashley Brown', 'Matthew Garcia', 'Jennifer Miller', 'Joshua Taylor',
                    'Lauren Anderson', 'Daniel Thomas', 'Megan Jackson', 'Andrew White',
                    'Samantha Harris', 'Ryan Clark', 'Nicole Lewis', 'Kevin Robinson',
                    'Rachel Walker', 'Brandon Hall', 'Stephanie Allen', 'Justin Young',
                    'Kimberly King', 'Tyler Wright', 'Michelle Lopez', 'Jonathan Hill',
                    'Elizabeth Scott', 'Anthony Green', 'Melissa Adams', 'Steven Baker',
                    'Laura Gonzalez', 'Eric Nelson', 'Amy Carter', 'Marcus Mitchell',
                    'Christina Perez', 'Brian Roberts', 'Angela Turner', 'Jason Phillips',
                    'Rebecca Campbell', 'Timothy Parker', 'Maria Evans', 'Jacob Edwards',
                    'Susan Collins', 'Nicholas Stewart', 'Katherine Sanchez', 'Patrick Morris'
                ];
                
                this.guests = [];
                this.constraints = [];
                this.tables.forEach(table => {
                    table.guests = new Array(6).fill(null);
                });
                
                // Add sample guests
                sampleGuests.forEach((name, index) => {
                    this.guests.push({
                        id: `guest_${index + 1}`,
                        name: name,
                        tableId: null,
                        seatPosition: null
                    });
                });
                
                // Add sample constraints
                const sampleConstraints = [
                    { guest1: 'Sarah Johnson', guest2: 'Michael Chen', type: 'must_sit_together' },
                    { guest1: 'Emily Davis', guest2: 'James Wilson', type: 'must_sit_together' },
                    { guest1: 'Jessica Martinez', guest2: 'David Thompson', type: 'must_sit_together' },
                    { guest1: 'Amanda Rodriguez', guest2: 'Christopher Lee', type: 'must_sit_together' },
                    { guest1: 'Ashley Brown', guest2: 'Matthew Garcia', type: 'must_not_sit_together' },
                    { guest1: 'Jennifer Miller', guest2: 'Joshua Taylor', type: 'must_not_sit_together' },
                    { guest1: 'Lauren Anderson', guest2: 'Daniel Thomas', type: 'must_sit_together' },
                    { guest1: 'Megan Jackson', guest2: 'Andrew White', type: 'must_sit_together' },
                    { guest1: 'Samantha Harris', guest2: 'Ryan Clark', type: 'must_not_sit_together' },
                    { guest1: 'Nicole Lewis', guest2: 'Kevin Robinson', type: 'must_sit_together' }
                ];
                
                sampleConstraints.forEach((sc, index) => {
                    const guest1 = this.guests.find(g => g.name === sc.guest1);
                    const guest2 = this.guests.find(g => g.name === sc.guest2);
                    
                    if (guest1 && guest2) {
                        this.constraints.push({
                            id: `constraint_${index + 1}`,
                            guest1Id: guest1.id,
                            guest2Id: guest2.id,
                            type: sc.type,
                            satisfied: true
                        });
                    }
                });
                
                this.saveToStorage();
                this.render();
                
                this.showNotification('Sample wedding data loaded! Try the auto-arrange feature to see the seating algorithm in action.', 'success');
                triggerHapticFeedback('success');
                this.closeGuestMenu();
            }

            render() {
                this.renderGuestList();
                this.renderTables();
                this.renderConstraints();
                this.renderConstraintSelects();
                this.updateStatus();
            }

            renderGuestList() {
                const container = document.getElementById('guestList');
                const countEl = document.getElementById('guestCount');
                
                countEl.textContent = this.guests.length;
                
                if (this.guests.length === 0) {
                    container.innerHTML = '<div class="text-text-tertiary text-sm">No guests added yet</div>';
                    return;
                }
                
                container.innerHTML = this.guests.map(guest => {
                    const assignedTable = this.getGuestTable(guest.id);
                    const tableText = assignedTable ? `Table ${assignedTable.number}` : 'Unassigned';
                    
                    return `
                        <div class="guest-item flex items-center justify-between p-3 bg-surface-tertiary/80 backdrop-blur-sm rounded-xl border border-surface-border/30 hover:border-surface-border/60 transition-all" 
                             draggable="true" data-guest-id="${guest.id}">
                            <div class="flex items-center gap-3 min-w-0">
                                <span class="font-semibold text-text-primary truncate">${guest.name}</span>
                                <span class="text-xs text-text-tertiary px-2 py-1 bg-surface-primary/50 rounded-full">${tableText}</span>
                            </div>
                            <button class="text-red-400 hover:text-red-300 p-2 rounded-lg hover:bg-red-500/20 transition-all" 
                                    onclick="seatPlanner.removeGuest('${guest.id}')" title="Remove guest">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    `;
                }).join('');
                
                // Add drag event listeners
                container.querySelectorAll('.guest-item').forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        this.draggedGuest = e.target.dataset.guestId;
                        e.target.classList.add('dragging');
                    });
                    
                    item.addEventListener('dragend', (e) => {
                        e.target.classList.remove('dragging');
                        this.draggedGuest = null;
                    });
                });
            }

            renderTables() {
                const container = document.getElementById('tablesContainer');
                
                container.innerHTML = this.tables.map(table => {
                    const seatsHtml = table.guests.map((guestId, seatIndex) => {
                        const guest = guestId ? this.guests.find(g => g.id === guestId) : null;
                        const seatClass = guest ? 'bg-blue-600 text-white' : 'bg-surface-border/60 text-text-tertiary border border-surface-border';
                        const seatContent = guest ? guest.name.split(' ').map(n => n[0]).join('') : (seatIndex + 1);
                        
                        return `
                            <div class="seat seat-${seatIndex} ${seatClass}" 
                                 data-table-id="${table.id}" 
                                 data-seat-index="${seatIndex}"
                                 title="${guest ? guest.name : `Table ${table.number}, Seat ${seatIndex + 1}`}">
                                ${seatContent}
                            </div>
                        `;
                    }).join('');
                    
                    const occupancy = table.guests.filter(g => g !== null).length;
                    
                    return `
                        <div class="text-center">
                            <div class="table-circle bg-surface-tertiary/80 backdrop-blur-sm border-2 border-surface-border/50 hover:border-primary-500/70 shadow-lg hover:shadow-xl" 
                                 data-table-id="${table.id}">
                                ${seatsHtml}
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="text-center">
                                        <div class="font-bold text-text-primary text-lg">${table.number}</div>
                                        <div class="text-xs text-text-tertiary font-medium">${occupancy}/${table.capacity}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Add drop event listeners
                container.querySelectorAll('.table-circle').forEach(tableEl => {
                    tableEl.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        tableEl.classList.add('drop-target');
                    });
                    
                    tableEl.addEventListener('dragleave', (e) => {
                        if (!tableEl.contains(e.relatedTarget)) {
                            tableEl.classList.remove('drop-target');
                        }
                    });
                    
                    tableEl.addEventListener('drop', (e) => {
                        e.preventDefault();
                        tableEl.classList.remove('drop-target');
                        
                        if (this.draggedGuest) {
                            const tableId = e.currentTarget.dataset.tableId;
                            const table = this.tables.find(t => t.id === tableId);
                            const emptySeat = table.guests.findIndex(g => g === null);
                            
                            if (emptySeat !== -1) {
                                this.assignGuestToSeat(this.draggedGuest, tableId, emptySeat);
                            }
                        }
                    });
                });
                
                // Add seat click listeners for direct assignment
                container.querySelectorAll('.seat').forEach(seatEl => {
                    seatEl.addEventListener('click', (e) => {
                        const tableId = e.target.dataset.tableId;
                        const seatIndex = parseInt(e.target.dataset.seatIndex);
                        const table = this.tables.find(t => t.id === tableId);
                        
                        if (table.guests[seatIndex] !== null) {
                            // Remove guest from seat
                            table.guests[seatIndex] = null;
                            this.saveToStorage();
                            this.render();
                        }
                    });
                });
            }

            renderConstraints() {
                const container = document.getElementById('constraintsList');
                const countEl = document.getElementById('constraintCount');
                
                countEl.textContent = this.constraints.length;
                
                if (this.constraints.length === 0) {
                    container.innerHTML = '<div class="text-text-tertiary text-sm">No seating rules added yet</div>';
                    return;
                }
                
                container.innerHTML = this.constraints.map(constraint => {
                    const guest1 = this.guests.find(g => g.id === constraint.guest1Id);
                    const guest2 = this.guests.find(g => g.id === constraint.guest2Id);
                    
                    if (!guest1 || !guest2) return '';
                    
                    const typeText = constraint.type === 'must_sit_together' ? 'Must sit together' : 'Must not sit together';
                    const typeClass = constraint.type === 'must_sit_together' ? 'text-green-400' : 'text-red-400';
                    
                    return `
                        <div class="flex items-center justify-between p-3 bg-surface-tertiary/60 backdrop-blur-sm rounded-xl border border-surface-border/30 hover:border-surface-border/60 transition-all">
                            <div class="min-w-0 flex-1">
                                <div class="font-semibold text-text-primary text-sm">${guest1.name} & ${guest2.name}</div>
                                <div class="${typeClass} text-xs font-medium mt-1">${typeText}</div>
                            </div>
                            <div class="flex items-center gap-3">
                                <button class="text-red-400 hover:text-red-300 p-1.5 rounded-lg hover:bg-red-500/20 transition-all" 
                                        onclick="seatPlanner.removeConstraint('${constraint.id}')" title="Remove seating rule">
                                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderConstraintSelects() {
                const dropdown = document.getElementById('guestMultiSelectDropdown');
                
                if (this.guests.length === 0) {
                    dropdown.innerHTML = '<div class="p-3 text-text-tertiary text-sm">No guests available</div>';
                    return;
                }
                
                dropdown.innerHTML = this.guests.map(guest => `
                    <div class="multi-select-option" onclick="seatPlanner.toggleGuestSelection('${guest.id}')">
                        <input type="checkbox" value="${guest.id}" ${this.selectedGuestIds.has(guest.id) ? 'checked' : ''} onclick="event.stopPropagation()">
                        <span>${guest.name}</span>
                    </div>
                `).join('');
                
                this.updateMultiSelectUI();
            }

            updateStatus() {
                const statusEl = document.getElementById('statusMessage');
                const validationEl = document.getElementById('validationStatus');
                
                const totalGuests = this.guests.length;
                const assignedGuests = this.tables.reduce((count, table) => 
                    count + table.guests.filter(g => g !== null).length, 0);
                const unassignedGuests = totalGuests - assignedGuests;
                
                statusEl.innerHTML = `<span class="font-semibold">${assignedGuests}/${totalGuests}</span> guests assigned <span class="text-text-tertiary">\u2022</span> <span class="${unassignedGuests > 0 ? 'text-yellow-400' : 'text-green-400'}">${unassignedGuests} unassigned</span>`;
                
                // Hide validation status if no constraints exist
                if (this.constraints.length === 0) {
                    validationEl.style.display = 'none';
                } else {
                    validationEl.style.display = 'block';
                    const allConstraintsSatisfied = this.validateConstraints();
                    const violatedConstraints = this.constraints.filter(c => !c.satisfied).length;
                    
                    if (allConstraintsSatisfied) {
                        validationEl.className = 'mt-4 p-4 card-panel flex-shrink-0';
                        validationEl.innerHTML = '<div class="text-sm text-green-400">All rules satisfied ✓</div>';
                    } else {
                        validationEl.className = 'mt-4 p-4 card-panel flex-shrink-0';
                        validationEl.innerHTML = `<div class="text-sm text-red-400">${violatedConstraints} rule(s) violated</div>`;
                    }
                }
            }

            showNotification(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `fixed bottom-4 right-4 p-3 rounded-lg shadow-lg z-50 transform translate-y-full transition-all duration-200 ${
                    type === 'success' ? 'bg-surface-secondary text-green-400 border border-green-500/20' :
                    type === 'error' ? 'bg-surface-secondary text-red-400 border border-red-500/20' :
                    'bg-surface-secondary text-text-primary border border-surface-border'
                }`;
                toast.innerHTML = `<div class="text-sm font-medium">${message}</div>`;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.transform = 'translateY(0)';
                }, 100);
                
                setTimeout(() => {
                    toast.style.transform = 'translateY(100%)';
                    setTimeout(() => {
                        if (document.body.contains(toast)) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }, 2500);
            }

            saveToStorage() {
                const data = {
                    guests: this.guests,
                    constraints: this.constraints,
                    tables: this.tables
                };
                localStorage.setItem('weddingSeatPlanner', JSON.stringify(data));
            }

            loadFromStorage() {
                const saved = localStorage.getItem('weddingSeatPlanner');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.guests = data.guests || [];
                    this.constraints = data.constraints || [];
                    if (data.tables) {
                        this.tables = data.tables;
                    }
                }
            }
        }

        // Initialize the application when the page loads
        let seatPlanner;
        document.addEventListener('DOMContentLoaded', () => {
            seatPlanner = new WeddingSeatPlanner();
        });
    </script>
</body>
</html>